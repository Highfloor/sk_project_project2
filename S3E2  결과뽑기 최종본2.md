```python
!jupyter nbconvert --to markdown '/content/drive/MyDrive/Cloud_Ai/3.머신러닝/S3E2  결과뽑기 최종본.ipynb'
```

# 모듈 설치


```python
'''
!pip uninstall sklearn -y
!pip install --upgrade sklearn
!pip install scikit-learn==0.23.2 --user
!pip install pycaret
!pip install catboost
!pip install --upgrade xgboost
'''
```




    '\n!pip uninstall sklearn -y\n!pip install --upgrade sklearn\n!pip install scikit-learn==0.23.2 --user\n!pip install pycaret\n!pip install catboost\n!pip install --upgrade xgboost\n'



# 데이터준비


```python
import pandas as pd

data_path= '/content/drive/MyDrive/Cloud_Ai/3.머신러닝/res/PG2'

train=pd.read_csv(data_path+'/train.csv')
test=pd.read_csv(data_path+'/test.csv')
submission=pd.read_csv(data_path+'/sample_submission.csv')
```


```python
def make_summary(df):
    print(f'데이터셋 형상: {df.shape}')
    summary = pd.DataFrame(df.dtypes, columns=['데이터 타입'])
    summary = summary.reset_index()
    summary = summary.rename(columns={'index': '피처'})
    summary['결측값 개수'] = df.isnull().sum().values
    summary['고윳값 개수'] = df.nunique().values
    return summary
```


```python
make_summary(train)
```

    데이터셋 형상: (15304, 12)






  <div id="df-ce58697b-8129-4246-aa4e-5224569895ee">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>피처</th>
      <th>데이터 타입</th>
      <th>결측값 개수</th>
      <th>고윳값 개수</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id</td>
      <td>int64</td>
      <td>0</td>
      <td>15304</td>
    </tr>
    <tr>
      <th>1</th>
      <td>gender</td>
      <td>object</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>age</td>
      <td>float64</td>
      <td>0</td>
      <td>106</td>
    </tr>
    <tr>
      <th>3</th>
      <td>hypertension</td>
      <td>int64</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>heart_disease</td>
      <td>int64</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>ever_married</td>
      <td>object</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>6</th>
      <td>work_type</td>
      <td>object</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Residence_type</td>
      <td>object</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>8</th>
      <td>avg_glucose_level</td>
      <td>float64</td>
      <td>0</td>
      <td>3740</td>
    </tr>
    <tr>
      <th>9</th>
      <td>bmi</td>
      <td>float64</td>
      <td>0</td>
      <td>407</td>
    </tr>
    <tr>
      <th>10</th>
      <td>smoking_status</td>
      <td>object</td>
      <td>0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>11</th>
      <td>stroke</td>
      <td>int64</td>
      <td>0</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-ce58697b-8129-4246-aa4e-5224569895ee')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-ce58697b-8129-4246-aa4e-5224569895ee button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-ce58697b-8129-4246-aa4e-5224569895ee');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
make_summary(test) # 불러온 데이터의 정보 확인
```

    데이터셋 형상: (10204, 11)






  <div id="df-73d020ca-a5e5-4c5a-bd5b-a406677ecb18">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>피처</th>
      <th>데이터 타입</th>
      <th>결측값 개수</th>
      <th>고윳값 개수</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id</td>
      <td>int64</td>
      <td>0</td>
      <td>10204</td>
    </tr>
    <tr>
      <th>1</th>
      <td>gender</td>
      <td>object</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>age</td>
      <td>float64</td>
      <td>0</td>
      <td>106</td>
    </tr>
    <tr>
      <th>3</th>
      <td>hypertension</td>
      <td>int64</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>heart_disease</td>
      <td>int64</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>ever_married</td>
      <td>object</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>6</th>
      <td>work_type</td>
      <td>object</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Residence_type</td>
      <td>object</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>8</th>
      <td>avg_glucose_level</td>
      <td>float64</td>
      <td>0</td>
      <td>3265</td>
    </tr>
    <tr>
      <th>9</th>
      <td>bmi</td>
      <td>float64</td>
      <td>0</td>
      <td>400</td>
    </tr>
    <tr>
      <th>10</th>
      <td>smoking_status</td>
      <td>object</td>
      <td>0</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-73d020ca-a5e5-4c5a-bd5b-a406677ecb18')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-73d020ca-a5e5-4c5a-bd5b-a406677ecb18 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-73d020ca-a5e5-4c5a-bd5b-a406677ecb18');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
submission.info() # 불러온 데이터의 정보 확인
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 10204 entries, 0 to 10203
    Data columns (total 2 columns):
     #   Column  Non-Null Count  Dtype  
    ---  ------  --------------  -----  
     0   id      10204 non-null  int64  
     1   stroke  10204 non-null  float64
    dtypes: float64(1), int64(1)
    memory usage: 159.6 KB



```python
train  # 불러온 데이터의 데이터프레임 확인
```





  <div id="df-aec6478e-a008-40a3-bbb1-319bc1499d05">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>gender</th>
      <th>age</th>
      <th>hypertension</th>
      <th>heart_disease</th>
      <th>ever_married</th>
      <th>work_type</th>
      <th>Residence_type</th>
      <th>avg_glucose_level</th>
      <th>bmi</th>
      <th>smoking_status</th>
      <th>stroke</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>Male</td>
      <td>28.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Urban</td>
      <td>79.53</td>
      <td>31.1</td>
      <td>never smoked</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Male</td>
      <td>33.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Rural</td>
      <td>78.44</td>
      <td>23.9</td>
      <td>formerly smoked</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>Female</td>
      <td>42.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Rural</td>
      <td>103.00</td>
      <td>40.3</td>
      <td>Unknown</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>Male</td>
      <td>56.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Urban</td>
      <td>64.87</td>
      <td>28.8</td>
      <td>never smoked</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>Female</td>
      <td>24.0</td>
      <td>0</td>
      <td>0</td>
      <td>No</td>
      <td>Private</td>
      <td>Rural</td>
      <td>73.36</td>
      <td>28.8</td>
      <td>never smoked</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>15299</th>
      <td>15299</td>
      <td>Female</td>
      <td>22.0</td>
      <td>0</td>
      <td>0</td>
      <td>No</td>
      <td>Govt_job</td>
      <td>Urban</td>
      <td>72.63</td>
      <td>19.5</td>
      <td>never smoked</td>
      <td>0</td>
    </tr>
    <tr>
      <th>15300</th>
      <td>15300</td>
      <td>Female</td>
      <td>46.0</td>
      <td>1</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Urban</td>
      <td>101.19</td>
      <td>32.1</td>
      <td>never smoked</td>
      <td>0</td>
    </tr>
    <tr>
      <th>15301</th>
      <td>15301</td>
      <td>Female</td>
      <td>75.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Self-employed</td>
      <td>Urban</td>
      <td>87.69</td>
      <td>26.2</td>
      <td>never smoked</td>
      <td>0</td>
    </tr>
    <tr>
      <th>15302</th>
      <td>15302</td>
      <td>Male</td>
      <td>46.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Rural</td>
      <td>101.13</td>
      <td>22.5</td>
      <td>Unknown</td>
      <td>0</td>
    </tr>
    <tr>
      <th>15303</th>
      <td>15303</td>
      <td>Female</td>
      <td>14.0</td>
      <td>0</td>
      <td>0</td>
      <td>No</td>
      <td>Private</td>
      <td>Rural</td>
      <td>85.12</td>
      <td>24.7</td>
      <td>never smoked</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>15304 rows × 12 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-aec6478e-a008-40a3-bbb1-319bc1499d05')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-aec6478e-a008-40a3-bbb1-319bc1499d05 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-aec6478e-a008-40a3-bbb1-319bc1499d05');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
test  # 불러온 데이터의 데이터프레임 확인
```





  <div id="df-e44021bc-288e-496c-9cc1-f6a6e6cc9af8">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>gender</th>
      <th>age</th>
      <th>hypertension</th>
      <th>heart_disease</th>
      <th>ever_married</th>
      <th>work_type</th>
      <th>Residence_type</th>
      <th>avg_glucose_level</th>
      <th>bmi</th>
      <th>smoking_status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>15304</td>
      <td>Female</td>
      <td>57.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Rural</td>
      <td>82.54</td>
      <td>33.4</td>
      <td>Unknown</td>
    </tr>
    <tr>
      <th>1</th>
      <td>15305</td>
      <td>Male</td>
      <td>70.0</td>
      <td>1</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Urban</td>
      <td>72.06</td>
      <td>28.5</td>
      <td>Unknown</td>
    </tr>
    <tr>
      <th>2</th>
      <td>15306</td>
      <td>Female</td>
      <td>5.0</td>
      <td>0</td>
      <td>0</td>
      <td>No</td>
      <td>children</td>
      <td>Urban</td>
      <td>103.72</td>
      <td>19.5</td>
      <td>Unknown</td>
    </tr>
    <tr>
      <th>3</th>
      <td>15307</td>
      <td>Female</td>
      <td>56.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Govt_job</td>
      <td>Urban</td>
      <td>69.24</td>
      <td>41.4</td>
      <td>smokes</td>
    </tr>
    <tr>
      <th>4</th>
      <td>15308</td>
      <td>Male</td>
      <td>32.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Rural</td>
      <td>111.15</td>
      <td>30.1</td>
      <td>smokes</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>10199</th>
      <td>25503</td>
      <td>Female</td>
      <td>27.0</td>
      <td>0</td>
      <td>0</td>
      <td>No</td>
      <td>Private</td>
      <td>Urban</td>
      <td>75.77</td>
      <td>17.6</td>
      <td>never smoked</td>
    </tr>
    <tr>
      <th>10200</th>
      <td>25504</td>
      <td>Male</td>
      <td>49.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Urban</td>
      <td>102.91</td>
      <td>26.7</td>
      <td>Unknown</td>
    </tr>
    <tr>
      <th>10201</th>
      <td>25505</td>
      <td>Female</td>
      <td>3.0</td>
      <td>0</td>
      <td>0</td>
      <td>No</td>
      <td>children</td>
      <td>Rural</td>
      <td>104.04</td>
      <td>18.3</td>
      <td>Unknown</td>
    </tr>
    <tr>
      <th>10202</th>
      <td>25506</td>
      <td>Male</td>
      <td>31.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Urban</td>
      <td>82.41</td>
      <td>28.7</td>
      <td>never smoked</td>
    </tr>
    <tr>
      <th>10203</th>
      <td>25507</td>
      <td>Female</td>
      <td>2.0</td>
      <td>0</td>
      <td>0</td>
      <td>No</td>
      <td>children</td>
      <td>Urban</td>
      <td>85.12</td>
      <td>14.8</td>
      <td>Unknown</td>
    </tr>
  </tbody>
</table>
<p>10204 rows × 11 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-e44021bc-288e-496c-9cc1-f6a6e6cc9af8')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-e44021bc-288e-496c-9cc1-f6a6e6cc9af8 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-e44021bc-288e-496c-9cc1-f6a6e6cc9af8');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
train.shape, test.shape, submission.shape # 불러온 데이터의 형태 확인
```




    ((15304, 12), (10204, 11), (10204, 2))



## 추가 데이터

- 캐글에서 원본데이터를 찾아추가하려고 한다


```python
train2=pd.read_csv(data_path+'/healthcare-dataset-stroke-data.csv') # 원본 데이터를 읽어오기
```


```python
make_summary(train2)  # 원본 데이터 정보 확인
```

    데이터셋 형상: (5110, 12)






  <div id="df-15ca85f0-83e7-43ae-9788-38db4f9aaa05">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>피처</th>
      <th>데이터 타입</th>
      <th>결측값 개수</th>
      <th>고윳값 개수</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id</td>
      <td>int64</td>
      <td>0</td>
      <td>5110</td>
    </tr>
    <tr>
      <th>1</th>
      <td>gender</td>
      <td>object</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>age</td>
      <td>float64</td>
      <td>0</td>
      <td>104</td>
    </tr>
    <tr>
      <th>3</th>
      <td>hypertension</td>
      <td>int64</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>heart_disease</td>
      <td>int64</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>ever_married</td>
      <td>object</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>6</th>
      <td>work_type</td>
      <td>object</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Residence_type</td>
      <td>object</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>8</th>
      <td>avg_glucose_level</td>
      <td>float64</td>
      <td>0</td>
      <td>3979</td>
    </tr>
    <tr>
      <th>9</th>
      <td>bmi</td>
      <td>float64</td>
      <td>201</td>
      <td>418</td>
    </tr>
    <tr>
      <th>10</th>
      <td>smoking_status</td>
      <td>object</td>
      <td>0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>11</th>
      <td>stroke</td>
      <td>int64</td>
      <td>0</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-15ca85f0-83e7-43ae-9788-38db4f9aaa05')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-15ca85f0-83e7-43ae-9788-38db4f9aaa05 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-15ca85f0-83e7-43ae-9788-38db4f9aaa05');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>




- info()를 보면 bmi에 결측치가 존재한다

- 결측치를 제거하기 위해 최근접 이웃 알고리즘(KNN)을 이용하여 결측치가 들어간 부분을 채울 것이다.


```python
# 결측치를 KNN을 이용하여 채우기 위한 함수
def knn_impute(df, na_target):
    df = df.copy()
    
    numeric_df = df.select_dtypes(np.number)
    non_na_columns = numeric_df.loc[: ,numeric_df.isna().sum() == 0].columns
    
    y_train = numeric_df.loc[numeric_df[na_target].isna() == False, na_target]
    X_train = numeric_df.loc[numeric_df[na_target].isna() == False, non_na_columns]
    X_test = numeric_df.loc[numeric_df[na_target].isna() == True, non_na_columns]
    
    knn = KNeighborsRegressor()
    knn.fit(X_train, y_train)
    
    y_pred = knn.predict(X_test)
    
    df.loc[df[na_target].isna() == True, na_target] = y_pred
    
    return df
```


```python
# 결측치가 있는 칸을 함수를 사용해서 채운다
from sklearn.neighbors import KNeighborsRegressor
import numpy as np
na_cols = [col for col in train2.columns if train2[col].isnull().sum()!=0]

for col in na_cols:  
    train2 = knn_impute(train2, col)

```


```python
make_summary(train2)
```

    데이터셋 형상: (5110, 12)






  <div id="df-460536ab-79e5-4307-a3d5-ebb59a5e74c0">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>피처</th>
      <th>데이터 타입</th>
      <th>결측값 개수</th>
      <th>고윳값 개수</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id</td>
      <td>int64</td>
      <td>0</td>
      <td>5110</td>
    </tr>
    <tr>
      <th>1</th>
      <td>gender</td>
      <td>object</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>age</td>
      <td>float64</td>
      <td>0</td>
      <td>104</td>
    </tr>
    <tr>
      <th>3</th>
      <td>hypertension</td>
      <td>int64</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>heart_disease</td>
      <td>int64</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>ever_married</td>
      <td>object</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>6</th>
      <td>work_type</td>
      <td>object</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Residence_type</td>
      <td>object</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>8</th>
      <td>avg_glucose_level</td>
      <td>float64</td>
      <td>0</td>
      <td>3979</td>
    </tr>
    <tr>
      <th>9</th>
      <td>bmi</td>
      <td>float64</td>
      <td>0</td>
      <td>557</td>
    </tr>
    <tr>
      <th>10</th>
      <td>smoking_status</td>
      <td>object</td>
      <td>0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>11</th>
      <td>stroke</td>
      <td>int64</td>
      <td>0</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-460536ab-79e5-4307-a3d5-ebb59a5e74c0')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-460536ab-79e5-4307-a3d5-ebb59a5e74c0 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-460536ab-79e5-4307-a3d5-ebb59a5e74c0');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
# concat을 사용하여 train데이터와 원본 데이터를 합친다
train=pd.concat([train,train2],axis=0).reset_index(drop=True)
```


```python
train
```





  <div id="df-7f06f2ec-1b3a-4197-adb3-c8068c99620f">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>gender</th>
      <th>age</th>
      <th>hypertension</th>
      <th>heart_disease</th>
      <th>ever_married</th>
      <th>work_type</th>
      <th>Residence_type</th>
      <th>avg_glucose_level</th>
      <th>bmi</th>
      <th>smoking_status</th>
      <th>stroke</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>Male</td>
      <td>28.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Urban</td>
      <td>79.53</td>
      <td>31.1</td>
      <td>never smoked</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Male</td>
      <td>33.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Rural</td>
      <td>78.44</td>
      <td>23.9</td>
      <td>formerly smoked</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>Female</td>
      <td>42.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Rural</td>
      <td>103.00</td>
      <td>40.3</td>
      <td>Unknown</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>Male</td>
      <td>56.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Urban</td>
      <td>64.87</td>
      <td>28.8</td>
      <td>never smoked</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>Female</td>
      <td>24.0</td>
      <td>0</td>
      <td>0</td>
      <td>No</td>
      <td>Private</td>
      <td>Rural</td>
      <td>73.36</td>
      <td>28.8</td>
      <td>never smoked</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>20409</th>
      <td>18234</td>
      <td>Female</td>
      <td>80.0</td>
      <td>1</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Urban</td>
      <td>83.75</td>
      <td>32.4</td>
      <td>never smoked</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20410</th>
      <td>44873</td>
      <td>Female</td>
      <td>81.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Self-employed</td>
      <td>Urban</td>
      <td>125.20</td>
      <td>40.0</td>
      <td>never smoked</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20411</th>
      <td>19723</td>
      <td>Female</td>
      <td>35.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Self-employed</td>
      <td>Rural</td>
      <td>82.99</td>
      <td>30.6</td>
      <td>never smoked</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20412</th>
      <td>37544</td>
      <td>Male</td>
      <td>51.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Private</td>
      <td>Rural</td>
      <td>166.29</td>
      <td>25.6</td>
      <td>formerly smoked</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20413</th>
      <td>44679</td>
      <td>Female</td>
      <td>44.0</td>
      <td>0</td>
      <td>0</td>
      <td>Yes</td>
      <td>Govt_job</td>
      <td>Urban</td>
      <td>85.28</td>
      <td>26.2</td>
      <td>Unknown</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>20414 rows × 12 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-7f06f2ec-1b3a-4197-adb3-c8068c99620f')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-7f06f2ec-1b3a-4197-adb3-c8068c99620f button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-7f06f2ec-1b3a-4197-adb3-c8068c99620f');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>




# EDA

## 이진형

- hypertension,heart_disease 는 아예 0,1로 값이 이루어져있다
- ever_married는 Yes,No로 이루어져있어 0과 1로 바꿔야한다
- Residence_type는 Urban, Rural로 이루어져 있으니 0과 1로 바꿔야한다

- gender도 이진이지만 other데이터하나가 껴있다
  - 그렇기 때문에 other를 Female로 바꾸어 넣을것이다


```python
train.hypertension.unique() 
```




    array([0, 1])




```python
train.gender.unique() #train 데이터안 성별에 other가 들어가있다
```




    array(['Male', 'Female', 'Other'], dtype=object)




```python
test.gender.unique() # test데이터도 성별에 other가 들어가있다
```




    array(['Female', 'Male', 'Other'], dtype=object)




```python
train.gender.unique() , test.gender.unique() 
```




    (array(['Male', 'Female', 'Other'], dtype=object),
     array(['Female', 'Male', 'Other'], dtype=object))




```python
train.heart_disease.unique() 
```




    array([0, 1])




```python
train.ever_married.unique()
```




    array(['Yes', 'No'], dtype=object)




```python
train.Residence_type.unique()
```




    array(['Urban', 'Rural'], dtype=object)



- 성별의 이상치인 other를 female로 바꾼다


```python
for n in range(20414):
  if train.gender[n] == 'Other':
    train.gender[n] = 'Female'

for n in range(10204):
  if test.gender[n] == 'Other':
    test.gender[n] = 'Female'
```

## 명목형

- work_type  (명목형)

- age,avg_glucose_level,bmi (수치형)


```python
train.work_type.unique()
```




    array(['Private', 'Self-employed', 'Govt_job', 'children', 'Never_worked'],
          dtype=object)




```python
train.age.unique(),train.avg_glucose_level.unique(),train.bmi.unique()
```




    (array([2.80e+01, 3.30e+01, 4.20e+01, 5.60e+01, 2.40e+01, 3.40e+01,
            5.30e+01, 7.80e+01, 4.50e+01, 6.20e+01, 5.10e+01, 4.00e+00,
            2.30e+01, 3.60e+01, 5.90e+01, 4.00e+01, 4.70e+01, 3.10e+01,
            1.72e+00, 7.10e+01, 5.00e+01, 5.50e+01, 3.80e+01, 5.70e+01,
            1.20e+01, 6.10e+01, 4.80e+01, 1.70e+01, 5.80e+01, 2.60e+01,
            8.00e+00, 2.00e+00, 3.90e+01, 5.20e+01, 1.90e+01, 5.40e+01,
            7.20e+01, 1.50e+01, 1.10e+01, 7.60e+01, 8.20e+01, 1.80e+01,
            7.40e+01, 4.30e+01, 2.10e+01, 6.50e+01, 9.00e+00, 8.00e+01,
            6.80e+01, 4.40e+01, 3.20e+01, 7.00e+00, 2.50e+01, 7.90e+01,
            6.30e+01, 5.00e+00, 8.10e+01, 1.00e+01, 3.00e+00, 6.00e+01,
            4.90e+01, 3.20e-01, 6.00e+00, 7.00e+01, 7.30e+01, 2.00e+01,
            4.60e+01, 3.70e+01, 6.70e+01, 2.90e+01, 6.90e+01, 1.32e+00,
            3.00e+01, 1.40e+01, 7.50e+01, 2.20e+01, 2.70e+01, 7.70e+01,
            3.50e+01, 6.60e+01, 1.80e+00, 1.88e+00, 8.80e-01, 1.30e+01,
            1.48e+00, 4.10e+01, 6.40e+01, 1.30e+00, 1.60e-01, 8.00e-01,
            1.60e+01, 1.64e+00, 1.40e+00, 6.40e-01, 4.00e-01, 1.24e+00,
            1.08e+00, 7.20e-01, 5.60e-01, 1.00e+00, 1.56e+00, 1.16e+00,
            4.80e-01, 8.00e-02, 6.80e-01, 2.40e-01]),
     array([ 79.53,  78.44, 103.  , ...,  76.89, 125.2 , 166.29]),
     array([31.1 , 23.9 , 40.3 , 28.8 , 22.2 , 25.3 , 24.8 , 34.1 , 18.4 ,
            20.1 , 23.5 , 14.1 , 37.3 , 29.6 , 28.1 , 27.7 , 28.4 , 32.5 ,
            28.2 , 20.8 , 33.5 , 36.7 , 26.9 , 27.  , 28.7 , 27.6 , 18.  ,
            26.4 , 41.  , 33.2 , 23.3 , 35.8 , 20.7 , 18.3 , 29.7 , 18.9 ,
            25.8 , 25.9 , 35.6 , 17.1 , 32.7 , 27.5 , 29.  , 17.6 , 29.9 ,
            27.3 , 19.8 , 27.8 , 29.2 , 24.3 , 23.  , 24.5 , 30.1 , 32.9 ,
            32.3 , 21.1 , 24.6 , 26.8 , 17.4 , 30.  , 23.1 , 34.8 , 35.7 ,
            31.7 , 39.1 , 41.3 , 31.4 , 25.1 , 22.6 , 16.4 , 31.3 , 29.4 ,
            31.9 , 34.9 , 26.1 , 35.  , 26.2 , 21.9 , 22.5 , 21.5 , 38.  ,
            32.6 , 26.  , 23.6 , 40.5 , 15.9 , 25.7 , 16.1 , 37.  , 25.6 ,
            24.7 , 16.2 , 30.7 , 23.4 , 20.2 , 21.3 , 40.7 , 38.7 , 35.9 ,
            24.4 , 22.  , 48.2 , 41.8 , 24.  , 30.9 , 27.9 , 27.4 , 28.  ,
            33.1 , 32.8 , 20.3 , 26.5 , 33.  , 31.6 , 15.8 , 39.5 , 26.7 ,
            41.5 , 24.1 , 21.6 , 34.6 , 26.3 , 22.8 , 22.1 , 18.2 , 34.7 ,
            22.9 , 37.8 , 23.8 , 39.  , 20.5 , 33.6 , 18.7 , 34.2 , 21.8 ,
            31.2 , 29.3 , 25.5 , 24.2 , 16.9 , 29.8 , 36.2 , 17.7 , 36.6 ,
            20.  , 22.4 , 31.  , 14.2 , 33.4 , 20.4 , 41.7 , 25.2 , 40.1 ,
            30.3 , 33.8 , 17.2 , 22.7 , 21.2 , 35.5 , 27.1 , 28.6 , 25.  ,
            30.5 , 28.5 , 26.6 , 29.5 , 38.5 , 39.8 , 32.1 , 31.5 , 39.6 ,
            28.3 , 21.7 , 35.2 , 24.9 , 28.9 , 36.9 , 21.  , 22.3 , 20.6 ,
            32.4 , 30.4 , 40.  , 37.1 , 34.4 , 42.2 , 38.9 , 21.4 , 15.  ,
            19.9 , 15.7 , 16.8 , 32.2 , 35.4 , 38.4 , 43.8 , 37.4 , 40.2 ,
            19.5 , 36.4 , 33.7 , 32.  , 15.1 , 45.2 , 30.2 , 19.4 , 18.1 ,
            36.  , 33.9 , 43.7 , 41.9 , 39.7 , 40.8 , 34.5 , 31.8 , 41.2 ,
            34.3 , 48.8 , 44.4 , 44.  , 18.6 , 38.8 , 37.7 , 23.2 , 19.7 ,
            15.4 , 29.1 , 23.7 , 19.1 , 15.5 , 17.3 , 15.2 , 17.  , 39.4 ,
            50.1 , 38.1 , 14.6 , 33.3 , 43.1 , 37.9 , 36.3 , 46.3 , 18.8 ,
            37.2 , 20.9 , 38.6 , 47.1 , 45.5 , 45.3 , 25.4 , 37.6 , 44.8 ,
            37.5 , 36.1 , 34.  , 16.3 , 15.3 , 46.9 , 30.6 , 61.8 , 40.9 ,
            39.2 , 54.7 , 38.2 , 57.2 , 47.5 , 43.6 , 16.6 , 41.6 , 30.8 ,
            18.5 , 19.6 , 41.1 , 16.  , 40.4 , 27.2 , 53.9 , 17.9 , 35.1 ,
            43.3 , 57.1 , 42.6 , 36.8 , 49.5 , 53.4 , 57.7 , 42.3 , 50.9 ,
            19.2 , 19.3 , 16.5 , 19.  , 17.5 , 54.3 , 38.3 , 49.3 , 41.4 ,
            43.9 , 49.9 , 44.7 , 43.4 , 14.4 , 45.  , 10.3 , 53.8 , 45.4 ,
            51.9 , 46.4 , 42.4 , 44.5 , 16.7 , 42.  , 12.8 , 35.3 , 52.8 ,
            45.7 , 14.5 , 50.2 , 52.3 , 63.6 , 15.6 , 48.1 , 17.8 , 60.9 ,
            39.3 , 43.2 , 46.  , 50.6 , 42.8 , 14.8 , 42.1 , 52.7 , 48.3 ,
            54.8 , 43.  , 54.  , 57.9 , 50.3 , 46.1 , 36.5 , 47.9 , 48.6 ,
            62.6 , 13.8 , 49.8 , 80.1 , 44.6 , 47.2 , 44.9 , 46.6 , 13.3 ,
            47.6 , 55.7 , 55.6 , 64.9 , 55.4 , 54.2 , 65.9 , 42.7 , 47.8 ,
            48.9 , 43.5 , 12.3 , 51.  , 55.1 , 14.3 , 45.9 , 47.3 , 57.3 ,
            13.5 , 14.  , 48.4 , 47.  , 55.2 , 39.9 , 50.4 , 54.6 , 46.2 ,
            45.1 , 55.  , 46.5 , 44.3 , 13.7 , 13.4 , 13.1 , 44.2 , 20.22,
            42.9 , 51.8 , 55.9 , 46.7 , 56.6 , 12.2 , 13.2 , 13.  , 14.9 ,
            51.5 , 13.9 , 49.4 , 60.7 , 54.9 , 45.6 , 42.5 , 54.4 , 52.9 ,
            65.36, 44.1 , 28.08, 28.54, 29.98, 31.26, 33.06, 32.74, 26.02,
            31.78, 23.08, 35.62, 30.74, 32.76, 28.32, 34.42, 27.76, 34.74,
            26.34, 27.56, 30.26, 28.52, 27.22, 28.18, 35.22, 26.12, 24.52,
            31.66, 35.24, 32.54, 26.22, 33.46, 27.72, 64.8 , 36.64, 30.12,
            60.2 , 32.18, 27.24, 34.44, 71.9 , 40.6 , 12.  , 27.74, 24.12,
            57.5 , 28.86, 26.14, 29.32, 35.82, 78.  , 29.14, 32.12, 28.94,
            29.28, 32.78, 25.42, 33.74, 29.66, 28.34, 31.48, 32.16, 27.68,
            40.12, 34.14, 33.86, 24.82, 26.68, 21.98, 23.78, 29.06, 29.36,
            28.22, 37.22, 66.8 , 48.5 , 31.36, 32.82, 36.72, 28.94, 56.  ,
            29.94, 26.58, 29.84, 26.32, 32.14, 29.62, 28.98, 41.16, 29.46,
            30.22, 34.72, 23.28, 56.1 , 42.58, 23.2 , 97.6 , 11.5 , 31.22,
            27.34, 26.44, 49.2 , 29.42, 48.7 , 25.44, 29.72, 32.48, 25.52,
            27.02, 32.28, 28.68, 27.18, 34.32, 33.84, 53.5 , 34.64, 50.5 ,
            31.86, 39.62, 63.3 , 28.64, 29.06, 61.2 , 34.58, 25.82, 48.  ,
            46.8 , 37.98, 34.18, 29.44, 28.66, 58.1 , 29.12, 26.54, 25.52,
            33.76, 26.66, 27.14, 38.44, 32.34, 11.3 , 28.58, 25.74, 30.78,
            59.7 , 47.4 , 31.88, 52.5 , 24.24, 32.38, 27.12, 25.62, 24.08,
            30.88, 29.36, 61.6 , 21.68, 27.42, 32.48, 64.4 , 30.08, 92.  ,
            50.8 , 26.92, 45.8 , 30.04, 31.98, 34.22, 51.7 , 54.1 , 29.42,
            24.54, 30.18, 34.84]))



## 순서형

- smoking_status
  - - 'never smoked', 'formerly smoked', 'Unknown', 'smokes' (unknown 순서를 어디다 두어야할지 정해야함)


```python
train.smoking_status.unique()
```




    array(['never smoked', 'formerly smoked', 'Unknown', 'smokes'],
          dtype=object)



# 시각화


```python
import seaborn as sns
import matplotlib.pyplot as plt
%matplotlib inline
```


```python
# 향후 시각화 자료에 비율을 표기하는 부분을 추가 => 텍스트 드로잉
def show_text_percent_by_targert( ax, total_count, is_show=True,  ):
  '''
    is_show : True일대만 텍스트가 노출되게 처리
    ax : 텍스트를 그리고자 하는 차트의 축정보
    total_count : 전체 카운트수
  '''
  persents = list()         # 비율을 담는 그릇
  # 카운트 플롯 차트상에 개별 박스 정보를 구하는 방법 -> ax.patches

  # 카운트 플롯 차트상에서 순차적으로 박스를 하나식 추출한다
  for patch in ax.patches: # 차트상에 존재하는 모든 형태의 도형을 차례대로 추출하는 연속형 변수
    w = patch.get_width()  # 타겟값 0 혹은 1, 카운트 플롯의 개별 박스 너비
    h = patch.get_height() # 타겟값 0 혹은 1의 카운트수 -> 카운트 플롯의 개별 박스 높이->카운트
    p = h/total_count * 100 # 타깃값의 비율 = (개별박스의 높이(카운트) / 전체카운트)*100
    persents.append( p )
    # 텍스트 그리기
    # 좌표 정보 획득
    l = patch.get_x()    # 도형 왼쪽 테투리 X축의 기준 위치값    
    ax.text(  x=l + w/2,  # 도형의 정 가운데를 X축 좌표
              y=h + total_count*0.005, # 1, total_count(가변값)의 특정 비율로 올려서 위치를 조정
              s=f'{p:1.1f}%', # 타겟값의 비율을 개별 차트내 도형 위에 그려지는 내용 ex) 38.8%
              ha='center'    # 정렬(가운데)
            )
  if is_show:
    if len(persents) == 2:   # 타겟용
      print( '타겟값간 비율', persents[0]/persents[1] )
    elif len(persents) == 4: # 이진 피처용
      # print( persents )
      # 타겟값에 맞춰서 도형이 그려진다 0번 타겟이 먼저 그려지고, 1번 타겟이 나중에 그려진다
      print( persents[0]/persents[2], persents[1]/persents[3] )
  pass

ax = sns.countplot( data=train, x='stroke');
show_text_percent_by_targert( ax, train.shape[0] )
ax.set_title('Target Value Distribution')
```

    타겟값간 비율 22.171396140749152





    Text(0.5, 1.0, 'Target Value Distribution')




![png](S3E2%20%20%E1%84%80%E1%85%A7%E1%86%AF%E1%84%80%E1%85%AA%E1%84%88%E1%85%A9%E1%86%B8%E1%84%80%E1%85%B5%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%E1%84%87%E1%85%A9%E1%86%AB_files/S3E2%20%20%E1%84%80%E1%85%A7%E1%86%AF%E1%84%80%E1%85%AA%E1%84%88%E1%85%A9%E1%86%B8%E1%84%80%E1%85%B5%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%E1%84%87%E1%85%A9%E1%86%AB_43_2.png)


## 이진형
- hypertension, heart_disease , ever_married ,gender,Residence_type


```python
ax = sns.countplot( data=train, x='gender', hue='stroke' );
show_text_percent_by_targert( ax, train.shape[0] )
ax.set_title('gender Value Distribution')
plt.show()
```

    20.430107526881716 23.44400785854617



![png](S3E2%20%20%E1%84%80%E1%85%A7%E1%86%AF%E1%84%80%E1%85%AA%E1%84%88%E1%85%A9%E1%86%B8%E1%84%80%E1%85%B5%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%E1%84%87%E1%85%A9%E1%86%AB_files/S3E2%20%20%E1%84%80%E1%85%A7%E1%86%AF%E1%84%80%E1%85%AA%E1%84%88%E1%85%A9%E1%86%B8%E1%84%80%E1%85%B5%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%E1%84%87%E1%85%A9%E1%86%AB_45_1.png)



```python
ax = sns.countplot( data=train, x='hypertension', hue='stroke' );
show_text_percent_by_targert( ax, train.shape[0] )
ax.set_title('hypertensions Value Distribution')
plt.show()
```

    26.882096069868997 5.489690721649484



![png](S3E2%20%20%E1%84%80%E1%85%A7%E1%86%AF%E1%84%80%E1%85%AA%E1%84%88%E1%85%A9%E1%86%B8%E1%84%80%E1%85%B5%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%E1%84%87%E1%85%A9%E1%86%AB_files/S3E2%20%20%E1%84%80%E1%85%A7%E1%86%AF%E1%84%80%E1%85%AA%E1%84%88%E1%85%A9%E1%86%B8%E1%84%80%E1%85%B5%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%E1%84%87%E1%85%A9%E1%86%AB_46_1.png)



```python
ax = sns.countplot( data=train, x='heart_disease', hue='stroke' );
show_text_percent_by_targert( ax, train.shape[0] )
ax.set_title('heart_disease Value Distribution')
plt.show()
```

    24.756510416666668 4.601769911504425



![png](S3E2%20%20%E1%84%80%E1%85%A7%E1%86%AF%E1%84%80%E1%85%AA%E1%84%88%E1%85%A9%E1%86%B8%E1%84%80%E1%85%B5%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%E1%84%87%E1%85%A9%E1%86%AB_files/S3E2%20%20%E1%84%80%E1%85%A7%E1%86%AF%E1%84%80%E1%85%AA%E1%84%88%E1%85%A9%E1%86%B8%E1%84%80%E1%85%B5%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%E1%84%87%E1%85%A9%E1%86%AB_47_1.png)



```python
ax = sns.countplot( data=train, x='ever_married', hue='stroke' );
show_text_percent_by_targert( ax, train.shape[0] )
ax.set_title('ever_married Value Distribution')
plt.show()
```

    15.939580764488285 94.37142857142858



![png](S3E2%20%20%E1%84%80%E1%85%A7%E1%86%AF%E1%84%80%E1%85%AA%E1%84%88%E1%85%A9%E1%86%B8%E1%84%80%E1%85%B5%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%E1%84%87%E1%85%A9%E1%86%AB_files/S3E2%20%20%E1%84%80%E1%85%A7%E1%86%AF%E1%84%80%E1%85%AA%E1%84%88%E1%85%A9%E1%86%B8%E1%84%80%E1%85%B5%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%E1%84%87%E1%85%A9%E1%86%AB_48_1.png)


- 위 3개의 그래프는 0과 1의 비율이 비슷하게 생겼다


```python
ax = sns.countplot( data=train, x='Residence_type', hue='stroke' );
show_text_percent_by_targert( ax, train.shape[0] )
ax.set_title('Residence_type Value Distribution')
plt.show()
```

    21.746666666666666 22.614849187935036



![png](S3E2%20%20%E1%84%80%E1%85%A7%E1%86%AF%E1%84%80%E1%85%AA%E1%84%88%E1%85%A9%E1%86%B8%E1%84%80%E1%85%B5%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%E1%84%87%E1%85%A9%E1%86%AB_files/S3E2%20%20%E1%84%80%E1%85%A7%E1%86%AF%E1%84%80%E1%85%AA%E1%84%88%E1%85%A9%E1%86%B8%E1%84%80%E1%85%B5%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%E1%84%87%E1%85%A9%E1%86%AB_50_1.png)


- Residence_type은 Urban이나 Rural나 0과 1의 비율차이가 없다
  - 이 피처는 변별력이 떨어진다
    - 피처를 제거하는 편이 정확도가 올라갈 것

## 명목
- work_type 
- age, avg_glucose_level, bmi


```python
ax = sns.countplot( data=train, x='work_type', hue='stroke' );
show_text_percent_by_targert( ax, train.shape[0] )
ax.set_title('work_type Value Distribution')
plt.show()
```

    WARNING:matplotlib.text:posx and posy should be finite values
    WARNING:matplotlib.text:posx and posy should be finite values



![png](S3E2%20%20%E1%84%80%E1%85%A7%E1%86%AF%E1%84%80%E1%85%AA%E1%84%88%E1%85%A9%E1%86%B8%E1%84%80%E1%85%B5%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%E1%84%87%E1%85%A9%E1%86%AB_files/S3E2%20%20%E1%84%80%E1%85%A7%E1%86%AF%E1%84%80%E1%85%AA%E1%84%88%E1%85%A9%E1%86%B8%E1%84%80%E1%85%B5%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%E1%84%87%E1%85%A9%E1%86%AB_53_1.png)


- 수치형은 컬럼이 너무많아 생략했다.
- 겹치는 값이 별로 안보이므로 변별력은 있을것이다

## 순서형


```python
import matplotlib.gridspec as gridspec # 격자 배치용
```


```python
def show_pointplot( feature, cross_tab, color, ax=None ):
  if ax:
    sns.pointplot(   x=feature,             # 피처값
                  y=1,            # 정답 1에 대한 포인트 플롯
                  data=cross_tab, # 그리는 대상 df
                  order=cross_tab[feature],     # 포인트플롯 순서
                  color=color,    # 그리는 색상
                  ax=ax
                  );
```


```python
def make_cross_tab( df , feature_name ):
  cross_tab = pd.crosstab( df[feature_name], df['stroke'], normalize='index' ) * 100
  cross_tab.reset_index( inplace=True )
  return cross_tab
```


```python
def show_count_point_plot( all_data, features, rows=3, cols=2 ):
  # 1개의 차트에 격자로 분할 -> 각 자리에 ax를 전달 -> 이것을 이용하여 그린다
  plt.figure( figsize=(25, 20) ) # 그리면서 조정 : 세로 3칸, 가로 2칸
  # 서브플롯 배치 
  p_grid = gridspec.GridSpec(rows, cols)  # 3줄, 2칸 => 차트 5개 => 피처가 5개

  for idx, feature in enumerate( features ):
    ax = plt.subplot( p_grid[idx] )
    cross_tab = make_cross_tab( all_data, feature )
    # order를 사용 했으면 한차트에 사용되는 모든 함수는 같은 순서(order) 유지 해야 동일하게 배치됨
    sns.countplot( data=all_data, x=feature, ax=ax, order=cross_tab[feature] )  # ax=ax : 격자 안에서 특정 위치로 차트가 세팅
    show_text_percent_by_targert( ax, all_data.shape[0] )
    ax.set_title(f'{ feature }\'s Value Distribution')
    show_pointplot( feature, cross_tab, 'blue', ax.twinx() )
  plt.show()
```


```python
ord_features = ['smoking_status']
```


```python
show_count_point_plot( train, ord_features)
```

    0.7447693625351769 1.0989085948158253



![png](S3E2%20%20%E1%84%80%E1%85%A7%E1%86%AF%E1%84%80%E1%85%AA%E1%84%88%E1%85%A9%E1%86%B8%E1%84%80%E1%85%B5%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%E1%84%87%E1%85%A9%E1%86%AB_files/S3E2%20%20%E1%84%80%E1%85%A7%E1%86%AF%E1%84%80%E1%85%AA%E1%84%88%E1%85%A9%E1%86%B8%E1%84%80%E1%85%B5%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC%E1%84%87%E1%85%A9%E1%86%AB_61_1.png)


- never smoked -> formerly smoked -> smokes는 순서형으로 볼수 있다.
- 하지만 Unknown은 어디에 들어갈지 모른다
  - 위의 시각화를 토대로 카운트가 많은 순으로 순서형을 하려고 한다

- 그래서 순서형의 순서는 never smoked ->Unknown -> formerly smoked -> smokes
으로 한다

# 인코딩

## 이진형

- 이진형중 0과 1로 이루어지지 않은 값들을 변환 매칭 테이블을 사용해 바꾼다


```python
train['gender'] = train['gender'].map( {'Male':1, 'Female':0})
train['ever_married']=train['ever_married'].map( {'Yes':1, 'No':0})

test['gender'] = test['gender'].map( {'Male':1, 'Female':0})
test['ever_married']=test['ever_married'].map( {'Yes':1, 'No':0})

bin_feats=['hypertension','heart_disease','ever_married' , 'gender']
```

## 명목형

- 글로 이루어진 work_type만 인코딩한다


```python
# work_type을 get_dummies를 사용하여 원-핫 인코딩한다음 난수를 부여해 데이터프레임으로 만든다
nom_train = pd.get_dummies(train['work_type'])
nom_test = pd.get_dummies(test['work_type'])
```


```python
nom_train
```





  <div id="df-9b661e59-841d-4698-b22b-8d53513f3ea2">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Govt_job</th>
      <th>Never_worked</th>
      <th>Private</th>
      <th>Self-employed</th>
      <th>children</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>20409</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20410</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20411</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20412</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20413</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>20414 rows × 5 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-9b661e59-841d-4698-b22b-8d53513f3ea2')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-9b661e59-841d-4698-b22b-8d53513f3ea2 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-9b661e59-841d-4698-b22b-8d53513f3ea2');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>




## 순서형


```python
ord_feat=['smoking_status']
ord_dict = { 'never smoked':0,'Unknown':1,'formerly smoked':2,'smokes':3}
train['smoking_status'] = train['smoking_status'].map( ord_dict )
test['smoking_status'] = test['smoking_status'].map( ord_dict )
ord_train_sample = train[ ord_feat]
ord_test_sample = test[ ord_feat]
```

# 피처스케일링

- 명목형중 수치로 이루어진 피처들의 값이 커 MinMaxScaler를 사용할것이다


```python
from sklearn.preprocessing import MinMaxScaler
# 수치형 피처들
nom_etc_feats = ['age','avg_glucose_level','bmi']

# 수치형 스케일링
alpha_enc = MinMaxScaler()
temp_alpha = pd.concat( [ train[ nom_etc_feats ], test[ nom_etc_feats ] ] )
alpha_enc.fit( temp_alpha )
enc_nom_etc_train = alpha_enc.transform( train[ nom_etc_feats ]  )
enc_nom_etc_test  = alpha_enc.transform( test[ nom_etc_feats ] )

nom_etc_test=pd.DataFrame( enc_nom_etc_test)
nom_etc_test.rename(columns = { 0:'age'}, inplace = True)
nom_etc_test.rename(columns = {1 : 'avg_glucose_level'}, inplace = True)
nom_etc_test.rename(columns = {2 : 'bmi'}, inplace = True)

nom_etc_train=pd.DataFrame( enc_nom_etc_train)
nom_etc_train.rename(columns = {0 : 'age'}, inplace = True)
nom_etc_train.rename(columns = {1 : 'avg_glucose_level'}, inplace = True)
nom_etc_train.rename(columns = {2 : 'bmi'}, inplace = True)
```

# 데이터 병합


```python
# 데이터 병합. 최종 train 데이터와 test 데이터 생성
final_train_data = pd.concat([train[bin_feats],nom_etc_train,nom_train,ord_train_sample],axis=1)
final_test_data = pd.concat([test[bin_feats],nom_etc_test,nom_test,ord_test_sample],axis=1)
```


```python
final_train_data
```





  <div id="df-5c8ada2d-ffe8-49b7-b1a8-79558a7a4e99">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>hypertension</th>
      <th>heart_disease</th>
      <th>ever_married</th>
      <th>gender</th>
      <th>age</th>
      <th>avg_glucose_level</th>
      <th>bmi</th>
      <th>Govt_job</th>
      <th>Never_worked</th>
      <th>Private</th>
      <th>Self-employed</th>
      <th>children</th>
      <th>smoking_status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0.340820</td>
      <td>0.112686</td>
      <td>0.238259</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0.401855</td>
      <td>0.107654</td>
      <td>0.155785</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0.511719</td>
      <td>0.221032</td>
      <td>0.343643</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0.682617</td>
      <td>0.045010</td>
      <td>0.211913</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.291992</td>
      <td>0.084203</td>
      <td>0.211913</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>20409</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0.975586</td>
      <td>0.132167</td>
      <td>0.253150</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20410</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0.987793</td>
      <td>0.323516</td>
      <td>0.340206</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20411</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0.426270</td>
      <td>0.128658</td>
      <td>0.232532</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20412</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0.621582</td>
      <td>0.513203</td>
      <td>0.175258</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>20413</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0.536133</td>
      <td>0.139230</td>
      <td>0.182131</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>20414 rows × 13 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-5c8ada2d-ffe8-49b7-b1a8-79558a7a4e99')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-5c8ada2d-ffe8-49b7-b1a8-79558a7a4e99 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-5c8ada2d-ffe8-49b7-b1a8-79558a7a4e99');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>




# 베이스라인


```python
'''
import pandas as pd
from sklearn.preprocessing import OneHotEncoder
from scipy import sparse
from sklearn.model_selection import train_test_split
from xgboost import XGBClassifier
from sklearn.model_selection import GridSearchCV

data_path= '/content/drive/MyDrive/Cloud_Ai/3.머신러닝/res/PG2'

train=pd.read_csv(data_path+'/train.csv')
test=pd.read_csv(data_path+'/test.csv')
submission=pd.read_csv(data_path+'/sample_submission.csv')
train.gender[9363]='Male'
test.gender[4629] = 'Male'
train['gender'] = train['gender'].map( {'Male':1, 'Female':0})
train['ever_married']=train['ever_married'].map( {'Yes':1, 'No':0})

test['gender'] = test['gender'].map( {'Male':1, 'Female':0})
test['ever_married']=test['ever_married'].map( {'Yes':1, 'No':0})
bin_feats=['hypertension','heart_disease','ever_married' , 'gender']
nom_one_hot_feats =['work_type' ,'Residence_type','smoking_status']

enc_nom_train = OneHotEncoder().fit_transform( train[ nom_one_hot_feats ] )
enc_nom_test = OneHotEncoder().fit_transform( test[ nom_one_hot_feats ] )

nom_etc_feats = ['age','avg_glucose_level','bmi']

alpha_enc = OneHotEncoder()
temp_alpha = pd.concat( [ train[ nom_etc_feats ], test[ nom_etc_feats ] ] )
alpha_enc.fit( temp_alpha )
enc_nom_etc_train = alpha_enc.transform( train[ nom_etc_feats ]  )
enc_nom_etc_test  = alpha_enc.transform( test[ nom_etc_feats ] )

final_train_data_csr= sparse.hstack([
    sparse.csc_matrix(train[bin_feats]), # bin 피처 DF,(300000,5) 
    enc_nom_train,   # nom_0~4 ,CSR ,(300000X25)
    enc_nom_etc_train, # nom_5~9 ,CSR (300000X16160)
],format='csr')

final_test_data_csr = sparse.hstack( [
    sparse.csc_matrix(test[bin_feats]), # bin 피처 (200000, 5), df
    enc_nom_test,         # nom_0~4, CSR (200000x25)
    enc_nom_etc_test,     # nom_5~9, CSR (200000x16016 )
], format='csr')
final_test_data_csr

X = final_train_data_csr
y = train['stroke']

# 테스트 데이터 비율을 조절하거나, 차후 제거하는것까지 검토 -> 성능향상을 위해서 
X_train, X_test, y_train, y_test = train_test_split(  X, y, 
                                                     test_size=0.15, stratify=y, random_state=0 )

eval_set=[(X_test, y_test)]

xgb_model = XGBClassifier(n_estimators=100)

# 후보 파라미터 선정
params = {'max_depth':[5,7], 'min_child_weight':[1,3], 'colsample_bytree':[0.5,0.75]}

# gridsearchcv 객체 정보 입력(어떤 모델, 파라미터 후보, 교차검증 몇 번)
gridcv = GridSearchCV(xgb_model, param_grid=params, cv=3)

# 파라미터 튜닝 시작
gridcv.fit(X_train, y_train, early_stopping_rounds=30, eval_metric='auc', eval_set=eval_set)

#튜닝된 파라미터 출력
print(gridcv.best_params_)

# 1차적으로 튜닝된 파라미터를 가지고 객체 생성
xgb_model = XGBClassifier(n_estimators=1000, learning_rate=0.02, max_depth=7, min_child_weight=1, colsample_bytree=0.75, reg_alpha=0.03)

# 학습
xgb_model.fit(X_train, y_train, early_stopping_rounds=200, eval_metric='auc', eval_set=eval_set)

y_pred=xgb_model.predict_proba( final_test_data_csr )[:, 1]
submission['stroke'] = y_pred
submission.to_csv('submission_ver1.csv',index=False)
'''
```




    "\nimport pandas as pd\nfrom sklearn.preprocessing import OneHotEncoder\nfrom scipy import sparse\nfrom sklearn.model_selection import train_test_split\nfrom xgboost import XGBClassifier\nfrom sklearn.model_selection import GridSearchCV\n\ndata_path= '/content/drive/MyDrive/Cloud_Ai/3.머신러닝/res/PG2'\n\ntrain=pd.read_csv(data_path+'/train.csv')\ntest=pd.read_csv(data_path+'/test.csv')\nsubmission=pd.read_csv(data_path+'/sample_submission.csv')\ntrain.gender[9363]='Male'\ntest.gender[4629] = 'Male'\ntrain['gender'] = train['gender'].map( {'Male':1, 'Female':0})\ntrain['ever_married']=train['ever_married'].map( {'Yes':1, 'No':0})\n\ntest['gender'] = test['gender'].map( {'Male':1, 'Female':0})\ntest['ever_married']=test['ever_married'].map( {'Yes':1, 'No':0})\nbin_feats=['hypertension','heart_disease','ever_married' , 'gender']\nnom_one_hot_feats =['work_type' ,'Residence_type','smoking_status']\n\nenc_nom_train = OneHotEncoder().fit_transform( train[ nom_one_hot_feats ] )\nenc_nom_test = OneHotEncoder().fit_transform( test[ nom_one_hot_feats ] )\n\nnom_etc_feats = ['age','avg_glucose_level','bmi']\n\nalpha_enc = OneHotEncoder()\ntemp_alpha = pd.concat( [ train[ nom_etc_feats ], test[ nom_etc_feats ] ] )\nalpha_enc.fit( temp_alpha )\nenc_nom_etc_train = alpha_enc.transform( train[ nom_etc_feats ]  )\nenc_nom_etc_test  = alpha_enc.transform( test[ nom_etc_feats ] )\n\nfinal_train_data_csr= sparse.hstack([\n    sparse.csc_matrix(train[bin_feats]), # bin 피처 DF,(300000,5) \n    enc_nom_train,   # nom_0~4 ,CSR ,(300000X25)\n    enc_nom_etc_train, # nom_5~9 ,CSR (300000X16160)\n],format='csr')\n\nfinal_test_data_csr = sparse.hstack( [\n    sparse.csc_matrix(test[bin_feats]), # bin 피처 (200000, 5), df\n    enc_nom_test,         # nom_0~4, CSR (200000x25)\n    enc_nom_etc_test,     # nom_5~9, CSR (200000x16016 )\n], format='csr')\nfinal_test_data_csr\n\nX = final_train_data_csr\ny = train['stroke']\n\n# 테스트 데이터 비율을 조절하거나, 차후 제거하는것까지 검토 -> 성능향상을 위해서 \nX_train, X_test, y_train, y_test = train_test_split(  X, y, \n                                                     test_size=0.15, stratify=y, random_state=0 )\n\neval_set=[(X_test, y_test)]\n\nxgb_model = XGBClassifier(n_estimators=100)\n\n# 후보 파라미터 선정\nparams = {'max_depth':[5,7], 'min_child_weight':[1,3], 'colsample_bytree':[0.5,0.75]}\n\n# gridsearchcv 객체 정보 입력(어떤 모델, 파라미터 후보, 교차검증 몇 번)\ngridcv = GridSearchCV(xgb_model, param_grid=params, cv=3)\n\n# 파라미터 튜닝 시작\ngridcv.fit(X_train, y_train, early_stopping_rounds=30, eval_metric='auc', eval_set=eval_set)\n\n#튜닝된 파라미터 출력\nprint(gridcv.best_params_)\n\n# 1차적으로 튜닝된 파라미터를 가지고 객체 생성\nxgb_model = XGBClassifier(n_estimators=1000, learning_rate=0.02, max_depth=7, min_child_weight=1, colsample_bytree=0.75, reg_alpha=0.03)\n\n# 학습\nxgb_model.fit(X_train, y_train, early_stopping_rounds=200, eval_metric='auc', eval_set=eval_set)\n\ny_pred=xgb_model.predict_proba( final_test_data_csr )[:, 1]\nsubmission['stroke'] = y_pred\nsubmission.to_csv('submission_ver1.csv',index=False)\n"



# 파이캐럿에서 직접모델 선정후 학습-예측


```python
final_test_data
```





  <div id="df-b9360b26-86e5-420b-89cb-91eebe83d2d7">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>hypertension</th>
      <th>heart_disease</th>
      <th>ever_married</th>
      <th>gender</th>
      <th>age</th>
      <th>avg_glucose_level</th>
      <th>bmi</th>
      <th>Govt_job</th>
      <th>Never_worked</th>
      <th>Private</th>
      <th>Self-employed</th>
      <th>children</th>
      <th>smoking_status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0.694824</td>
      <td>0.126581</td>
      <td>0.264605</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0.853516</td>
      <td>0.078201</td>
      <td>0.208477</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.060059</td>
      <td>0.224356</td>
      <td>0.105384</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0.682617</td>
      <td>0.065183</td>
      <td>0.356243</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0.389648</td>
      <td>0.258656</td>
      <td>0.226804</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>10199</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.328613</td>
      <td>0.095328</td>
      <td>0.083620</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10200</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0.597168</td>
      <td>0.220617</td>
      <td>0.187858</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>10201</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.035645</td>
      <td>0.225833</td>
      <td>0.091638</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>10202</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0.377441</td>
      <td>0.125981</td>
      <td>0.210767</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10203</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.023438</td>
      <td>0.138491</td>
      <td>0.051546</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>10204 rows × 13 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-b9360b26-86e5-420b-89cb-91eebe83d2d7')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-b9360b26-86e5-420b-89cb-91eebe83d2d7 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-b9360b26-86e5-420b-89cb-91eebe83d2d7');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
from pycaret.classification import *
from xgboost import XGBClassifier
from sklearn.model_selection import train_test_split

X = final_train_data
y = train['stroke']
X_train, X_test, y_train, y_test = train_test_split(  X, y, 
                                                     test_size=0.15, stratify=y, random_state=0 )

target_name = 'stroke' 
clf = setup(  data = pd.concat([final_test_data,train['stroke']],axis=1),               # 데이터
              target=target_name,     # 정답 피처명
              silent=True,            # 데이터 조정은 알아서
              verbose=True,           # 로그출력
              train_size = 0.9,       # 훈련 데이터 비율
              data_split_shuffle=False,   # 스플릿 할때 섞는 여부
              normalize = True,       # 정규화 할것인지
              session_id=100          # 난수시드
            )
model_xgb       = create_model('xgboost', fold = 5)
tune_model_xgb      = tune_model(model_xgb,       fold=5, optimize = 'AUC', choose_better = True)

eval_set=[(X_test, y_test)]
xgb_clf_model = tune_model_xgb
xgb_clf_model.fit(X, y, 
    early_stopping_rounds=100, eval_metric='logloss', eval_set=eval_set, # 3개는 같이 움직임
    verbose=True # 로그 출력             
)
y_pred=xgb_clf_model.predict_proba( final_test_data )[:, 1]
submission['stroke'] = y_pred
submission.to_csv('base_submission.csv',index=False)
```



  <div id="df-ddda7a45-eb59-402b-99af-59dfdd691932">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>AUC</th>
      <th>Recall</th>
      <th>Prec.</th>
      <th>F1</th>
      <th>Kappa</th>
      <th>MCC</th>
    </tr>
    <tr>
      <th>Fold</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.9521</td>
      <td>0.5821</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.9510</td>
      <td>0.5196</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>-0.0016</td>
      <td>-0.0064</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.9510</td>
      <td>0.5473</td>
      <td>0.0057</td>
      <td>0.1667</td>
      <td>0.0110</td>
      <td>0.0079</td>
      <td>0.0225</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.9521</td>
      <td>0.5000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.9521</td>
      <td>0.5000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Mean</th>
      <td>0.9517</td>
      <td>0.5298</td>
      <td>0.0011</td>
      <td>0.0333</td>
      <td>0.0022</td>
      <td>0.0012</td>
      <td>0.0032</td>
    </tr>
    <tr>
      <th>Std</th>
      <td>0.0005</td>
      <td>0.0314</td>
      <td>0.0023</td>
      <td>0.0667</td>
      <td>0.0044</td>
      <td>0.0034</td>
      <td>0.0100</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-ddda7a45-eb59-402b-99af-59dfdd691932')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-ddda7a45-eb59-402b-99af-59dfdd691932 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-ddda7a45-eb59-402b-99af-59dfdd691932');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>



    INFO:logs:create_model_container: 3
    INFO:logs:master_model_container: 3
    INFO:logs:display_container: 3
    INFO:logs:XGBClassifier(base_score=None, booster='gbtree', callbacks=None,
                  colsample_bylevel=None, colsample_bynode=None,
                  colsample_bytree=0.7, early_stopping_rounds=None,
                  enable_categorical=False, eval_metric=None, feature_types=None,
                  gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
                  interaction_constraints=None, learning_rate=0.1, max_bin=None,
                  max_cat_threshold=None, max_cat_to_onehot=None,
                  max_delta_step=None, max_depth=2, max_leaves=None,
                  min_child_weight=1, missing=nan, monotone_constraints=None,
                  n_estimators=180, n_jobs=-1, num_parallel_tree=None,
                  objective='binary:logistic', predictor=None, ...)
    INFO:logs:tune_model() succesfully completed......................................


    [0]	validation_0-logloss:0.63867
    [1]	validation_0-logloss:0.59292
    [2]	validation_0-logloss:0.55298
    [3]	validation_0-logloss:0.50981
    [4]	validation_0-logloss:0.48040
    [5]	validation_0-logloss:0.44782
    [6]	validation_0-logloss:0.41994
    [7]	validation_0-logloss:0.40043
    [8]	validation_0-logloss:0.37835
    [9]	validation_0-logloss:0.35989
    [10]	validation_0-logloss:0.34649
    [11]	validation_0-logloss:0.33185
    [12]	validation_0-logloss:0.31908
    [13]	validation_0-logloss:0.30761
    [14]	validation_0-logloss:0.29809
    [15]	validation_0-logloss:0.29066
    [16]	validation_0-logloss:0.28396
    [17]	validation_0-logloss:0.27759
    [18]	validation_0-logloss:0.27088
    [19]	validation_0-logloss:0.26661
    [20]	validation_0-logloss:0.26125
    [21]	validation_0-logloss:0.25752
    [22]	validation_0-logloss:0.25297
    [23]	validation_0-logloss:0.25028
    [24]	validation_0-logloss:0.24623
    [25]	validation_0-logloss:0.24408
    [26]	validation_0-logloss:0.24097
    [27]	validation_0-logloss:0.23773
    [28]	validation_0-logloss:0.23478
    [29]	validation_0-logloss:0.23252
    [30]	validation_0-logloss:0.23121
    [31]	validation_0-logloss:0.22956
    [32]	validation_0-logloss:0.22819
    [33]	validation_0-logloss:0.22697
    [34]	validation_0-logloss:0.22604
    [35]	validation_0-logloss:0.22450
    [36]	validation_0-logloss:0.22307
    [37]	validation_0-logloss:0.22191
    [38]	validation_0-logloss:0.22092
    [39]	validation_0-logloss:0.22012
    [40]	validation_0-logloss:0.21971
    [41]	validation_0-logloss:0.21929
    [42]	validation_0-logloss:0.21888
    [43]	validation_0-logloss:0.21852
    [44]	validation_0-logloss:0.21823
    [45]	validation_0-logloss:0.21792
    [46]	validation_0-logloss:0.21717
    [47]	validation_0-logloss:0.21665
    [48]	validation_0-logloss:0.21611
    [49]	validation_0-logloss:0.21592
    [50]	validation_0-logloss:0.21491
    [51]	validation_0-logloss:0.21449
    [52]	validation_0-logloss:0.21360
    [53]	validation_0-logloss:0.21318
    [54]	validation_0-logloss:0.21293
    [55]	validation_0-logloss:0.21276
    [56]	validation_0-logloss:0.21256
    [57]	validation_0-logloss:0.21247
    [58]	validation_0-logloss:0.21231
    [59]	validation_0-logloss:0.21218
    [60]	validation_0-logloss:0.21210
    [61]	validation_0-logloss:0.21185
    [62]	validation_0-logloss:0.21167
    [63]	validation_0-logloss:0.21202
    [64]	validation_0-logloss:0.21177
    [65]	validation_0-logloss:0.21149
    [66]	validation_0-logloss:0.21137
    [67]	validation_0-logloss:0.21128
    [68]	validation_0-logloss:0.21114
    [69]	validation_0-logloss:0.21053
    [70]	validation_0-logloss:0.21002
    [71]	validation_0-logloss:0.20997
    [72]	validation_0-logloss:0.20971
    [73]	validation_0-logloss:0.20936
    [74]	validation_0-logloss:0.20951
    [75]	validation_0-logloss:0.20936
    [76]	validation_0-logloss:0.20931
    [77]	validation_0-logloss:0.20926
    [78]	validation_0-logloss:0.20941
    [79]	validation_0-logloss:0.20908
    [80]	validation_0-logloss:0.20897
    [81]	validation_0-logloss:0.20900
    [82]	validation_0-logloss:0.20927
    [83]	validation_0-logloss:0.20910
    [84]	validation_0-logloss:0.20913
    [85]	validation_0-logloss:0.20895
    [86]	validation_0-logloss:0.20874
    [87]	validation_0-logloss:0.20865
    [88]	validation_0-logloss:0.20884
    [89]	validation_0-logloss:0.20852
    [90]	validation_0-logloss:0.20849
    [91]	validation_0-logloss:0.20843
    [92]	validation_0-logloss:0.20853
    [93]	validation_0-logloss:0.20840
    [94]	validation_0-logloss:0.20800
    [95]	validation_0-logloss:0.20800
    [96]	validation_0-logloss:0.20796
    [97]	validation_0-logloss:0.20775
    [98]	validation_0-logloss:0.20748
    [99]	validation_0-logloss:0.20685
    [100]	validation_0-logloss:0.20664
    [101]	validation_0-logloss:0.20658
    [102]	validation_0-logloss:0.20629
    [103]	validation_0-logloss:0.20608
    [104]	validation_0-logloss:0.20645
    [105]	validation_0-logloss:0.20649
    [106]	validation_0-logloss:0.20612
    [107]	validation_0-logloss:0.20634
    [108]	validation_0-logloss:0.20588
    [109]	validation_0-logloss:0.20626
    [110]	validation_0-logloss:0.20639
    [111]	validation_0-logloss:0.20639
    [112]	validation_0-logloss:0.20641
    [113]	validation_0-logloss:0.20648
    [114]	validation_0-logloss:0.20631
    [115]	validation_0-logloss:0.20611
    [116]	validation_0-logloss:0.20600
    [117]	validation_0-logloss:0.20561
    [118]	validation_0-logloss:0.20497
    [119]	validation_0-logloss:0.20484
    [120]	validation_0-logloss:0.20451
    [121]	validation_0-logloss:0.20430
    [122]	validation_0-logloss:0.20420
    [123]	validation_0-logloss:0.20468
    [124]	validation_0-logloss:0.20452
    [125]	validation_0-logloss:0.20473
    [126]	validation_0-logloss:0.20436
    [127]	validation_0-logloss:0.20409
    [128]	validation_0-logloss:0.20405
    [129]	validation_0-logloss:0.20413
    [130]	validation_0-logloss:0.20413
    [131]	validation_0-logloss:0.20393
    [132]	validation_0-logloss:0.20367
    [133]	validation_0-logloss:0.20355
    [134]	validation_0-logloss:0.20326
    [135]	validation_0-logloss:0.20297
    [136]	validation_0-logloss:0.20306
    [137]	validation_0-logloss:0.20343
    [138]	validation_0-logloss:0.20324
    [139]	validation_0-logloss:0.20308
    [140]	validation_0-logloss:0.20279
    [141]	validation_0-logloss:0.20267
    [142]	validation_0-logloss:0.20247
    [143]	validation_0-logloss:0.20236
    [144]	validation_0-logloss:0.20221
    [145]	validation_0-logloss:0.20248
    [146]	validation_0-logloss:0.20311
    [147]	validation_0-logloss:0.20277
    [148]	validation_0-logloss:0.20323
    [149]	validation_0-logloss:0.20295
    [150]	validation_0-logloss:0.20293
    [151]	validation_0-logloss:0.20299
    [152]	validation_0-logloss:0.20270
    [153]	validation_0-logloss:0.20269
    [154]	validation_0-logloss:0.20275
    [155]	validation_0-logloss:0.20263
    [156]	validation_0-logloss:0.20219
    [157]	validation_0-logloss:0.20238
    [158]	validation_0-logloss:0.20243
    [159]	validation_0-logloss:0.20274
    [160]	validation_0-logloss:0.20243
    [161]	validation_0-logloss:0.20225
    [162]	validation_0-logloss:0.20190
    [163]	validation_0-logloss:0.20219
    [164]	validation_0-logloss:0.20203
    [165]	validation_0-logloss:0.20165
    [166]	validation_0-logloss:0.20190
    [167]	validation_0-logloss:0.20199
    [168]	validation_0-logloss:0.20164
    [169]	validation_0-logloss:0.20181
    [170]	validation_0-logloss:0.20197
    [171]	validation_0-logloss:0.20146
    [172]	validation_0-logloss:0.20178
    [173]	validation_0-logloss:0.20206
    [174]	validation_0-logloss:0.20230
    [175]	validation_0-logloss:0.20242
    [176]	validation_0-logloss:0.20257
    [177]	validation_0-logloss:0.20225
    [178]	validation_0-logloss:0.20262
    [179]	validation_0-logloss:0.20296


# 총합 코드


```python
import pandas as pd
import numpy as np
from sklearn.preprocessing import OneHotEncoder,MinMaxScaler
from sklearn.model_selection import train_test_split
from xgboost import XGBClassifier
from sklearn.neighbors import KNeighborsRegressor
from pycaret.classification import *

data_path= '/content/drive/MyDrive/Cloud_Ai/3.머신러닝/res/PG2'

train=pd.read_csv(data_path+'/train.csv')
train2=pd.read_csv(data_path+'/healthcare-dataset-stroke-data.csv')
test=pd.read_csv(data_path+'/test.csv')
submission=pd.read_csv(data_path+'/sample_submission.csv')

def knn_impute(df, na_target):
    df = df.copy()
    
    numeric_df = df.select_dtypes(np.number)
    non_na_columns = numeric_df.loc[: ,numeric_df.isna().sum() == 0].columns
    
    y_train = numeric_df.loc[numeric_df[na_target].isna() == False, na_target]
    X_train = numeric_df.loc[numeric_df[na_target].isna() == False, non_na_columns]
    X_test = numeric_df.loc[numeric_df[na_target].isna() == True, non_na_columns]
    
    knn = KNeighborsRegressor()
    knn.fit(X_train, y_train)
    
    y_pred = knn.predict(X_test)
    
    df.loc[df[na_target].isna() == True, na_target] = y_pred
    
    return df

na_cols = [col for col in train2.columns if train2[col].isnull().sum()!=0]

for col in na_cols:  
    train2 = knn_impute(train2, col)

train=pd.concat([train,train2],axis=0).reset_index(drop=True)

# other 그냥 female로 바꿈
for n in range(20414):
  if train.gender[n] == 'Other':
    train.gender[n] = 'Female'

for n in range(10204):
  if test.gender[n] == 'Other':
    test.gender[n] = 'Female'

# 이진형
train['gender'] = train['gender'].map( {'Male':1, 'Female':0})
train['ever_married']=train['ever_married'].map( {'Yes':1, 'No':0})

test['gender'] = test['gender'].map( {'Male':1, 'Female':0})
test['ever_married']=test['ever_married'].map( {'Yes':1, 'No':0})


# 이진형 피처들
bin_feats=['hypertension','heart_disease','ever_married' , 'gender']

# work_type을 원-핫 인코딩
nom_train = pd.get_dummies(train['work_type'])
nom_test = pd.get_dummies(test['work_type'])


# 수치형 피처들
nom_etc_feats = ['age','avg_glucose_level','bmi']

# 수치형 스케일링
alpha_enc = MinMaxScaler()
temp_alpha = pd.concat( [ train[ nom_etc_feats ], test[ nom_etc_feats ] ] )
alpha_enc.fit( temp_alpha )
enc_nom_etc_train = alpha_enc.transform( train[ nom_etc_feats ]  )
enc_nom_etc_test  = alpha_enc.transform( test[ nom_etc_feats ] )

nom_etc_test=pd.DataFrame( enc_nom_etc_test)
nom_etc_test.rename(columns = { 0:'age'}, inplace = True)
nom_etc_test.rename(columns = {1 : 'avg_glucose_level'}, inplace = True)

nom_etc_train=pd.DataFrame( enc_nom_etc_train)
nom_etc_train.rename(columns = {0 : 'age'}, inplace = True)
nom_etc_train.rename(columns = {1 : 'avg_glucose_level'}, inplace = True)

# 순서형
ord_feat=['smoking_status']
ord_dict = { 'never smoked':0,'Unknown':1,'formerly smoked':2,'smokes':3}
train['smoking_status'] = train['smoking_status'].map( ord_dict )
test['smoking_status'] = test['smoking_status'].map( ord_dict )
ord_train_sample = train[ ord_feat]
ord_test_sample = test[ ord_feat]



# 데이터 병합. 최종 train 데이터와 test 데이터 생성
final_train_data = pd.concat([train[bin_feats],nom_etc_train,nom_train,ord_train_sample],axis=1)
final_test_data = pd.concat([test[bin_feats],nom_etc_test,nom_test,ord_test_sample],axis=1)

X = final_train_data
y = train['stroke']
X_train, X_test, y_train, y_test = train_test_split(  X, y, 
                                                     test_size=0.15, stratify=y, random_state=2023 )

target_name = 'stroke' # malignant
clf = setup(  data = pd.concat([final_test_data,train['stroke']],axis=1),               # 데이터
              target=target_name,     # 정답 피처명
              silent=True,            # 데이터 조정은 알아서
              verbose=True,           # 로그출력
              train_size = 0.9,       # 훈련 데이터 비율
              data_split_shuffle=False,   # 스플릿 할때 섞는 여부
              normalize = True,       # 정규화 할것인지
              session_id=100          # 난수시드
            )
model_xgb       = create_model('xgboost', fold = 5)
tune_model_xgb      = tune_model(model_xgb,       fold=5, optimize = 'AUC', choose_better = True)

eval_set=[(X_test, y_test)]
xgb_clf_model = tune_model_xgb
xgb_clf_model.fit(X, y, 
    # 조기학습 종료 체크는 검증용 데이터로 수행한다,. 
    early_stopping_rounds=100, eval_metric='logloss', eval_set=eval_set, # 3개는 같이 움직임
    verbose=True # 로그 출력             
)
y_pred=xgb_clf_model.predict_proba( final_test_data )[:, 1]
submission['stroke'] = y_pred
submission.to_csv('submission_S3E2.csv',index=False)
```



  <div id="df-d35b780d-828c-489a-9449-852174937835">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>AUC</th>
      <th>Recall</th>
      <th>Prec.</th>
      <th>F1</th>
      <th>Kappa</th>
      <th>MCC</th>
    </tr>
    <tr>
      <th>Fold</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.9521</td>
      <td>0.5821</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.9510</td>
      <td>0.5196</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>-0.0016</td>
      <td>-0.0064</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.9510</td>
      <td>0.5473</td>
      <td>0.0057</td>
      <td>0.1667</td>
      <td>0.0110</td>
      <td>0.0079</td>
      <td>0.0225</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.9521</td>
      <td>0.5000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.9521</td>
      <td>0.5000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Mean</th>
      <td>0.9517</td>
      <td>0.5298</td>
      <td>0.0011</td>
      <td>0.0333</td>
      <td>0.0022</td>
      <td>0.0012</td>
      <td>0.0032</td>
    </tr>
    <tr>
      <th>Std</th>
      <td>0.0005</td>
      <td>0.0314</td>
      <td>0.0023</td>
      <td>0.0667</td>
      <td>0.0044</td>
      <td>0.0034</td>
      <td>0.0100</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-d35b780d-828c-489a-9449-852174937835')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-d35b780d-828c-489a-9449-852174937835 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-d35b780d-828c-489a-9449-852174937835');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>



    INFO:logs:create_model_container: 3
    INFO:logs:master_model_container: 3
    INFO:logs:display_container: 3
    INFO:logs:XGBClassifier(base_score=None, booster='gbtree', callbacks=None,
                  colsample_bylevel=None, colsample_bynode=None,
                  colsample_bytree=0.7, early_stopping_rounds=None,
                  enable_categorical=False, eval_metric=None, feature_types=None,
                  gamma=None, gpu_id=None, grow_policy=None, importance_type=None,
                  interaction_constraints=None, learning_rate=0.1, max_bin=None,
                  max_cat_threshold=None, max_cat_to_onehot=None,
                  max_delta_step=None, max_depth=2, max_leaves=None,
                  min_child_weight=1, missing=nan, monotone_constraints=None,
                  n_estimators=180, n_jobs=-1, num_parallel_tree=None,
                  objective='binary:logistic', predictor=None, ...)
    INFO:logs:tune_model() succesfully completed......................................


    [0]	validation_0-logloss:0.63852
    [1]	validation_0-logloss:0.59220
    [2]	validation_0-logloss:0.55216
    [3]	validation_0-logloss:0.50996
    [4]	validation_0-logloss:0.48052
    [5]	validation_0-logloss:0.44881
    [6]	validation_0-logloss:0.42171
    [7]	validation_0-logloss:0.40217
    [8]	validation_0-logloss:0.38069
    [9]	validation_0-logloss:0.36293
    [10]	validation_0-logloss:0.34923
    [11]	validation_0-logloss:0.33512
    [12]	validation_0-logloss:0.32285
    [13]	validation_0-logloss:0.31188
    [14]	validation_0-logloss:0.30281
    [15]	validation_0-logloss:0.29524
    [16]	validation_0-logloss:0.28852
    [17]	validation_0-logloss:0.28207
    [18]	validation_0-logloss:0.27575
    [19]	validation_0-logloss:0.27134
    [20]	validation_0-logloss:0.26635
    [21]	validation_0-logloss:0.26246
    [22]	validation_0-logloss:0.25802
    [23]	validation_0-logloss:0.25524
    [24]	validation_0-logloss:0.25147
    [25]	validation_0-logloss:0.24930
    [26]	validation_0-logloss:0.24645
    [27]	validation_0-logloss:0.24336
    [28]	validation_0-logloss:0.24061
    [29]	validation_0-logloss:0.23839
    [30]	validation_0-logloss:0.23700
    [31]	validation_0-logloss:0.23543
    [32]	validation_0-logloss:0.23410
    [33]	validation_0-logloss:0.23287
    [34]	validation_0-logloss:0.23200
    [35]	validation_0-logloss:0.23040
    [36]	validation_0-logloss:0.22899
    [37]	validation_0-logloss:0.22797
    [38]	validation_0-logloss:0.22700
    [39]	validation_0-logloss:0.22614
    [40]	validation_0-logloss:0.22569
    [41]	validation_0-logloss:0.22515
    [42]	validation_0-logloss:0.22475
    [43]	validation_0-logloss:0.22450
    [44]	validation_0-logloss:0.22422
    [45]	validation_0-logloss:0.22398
    [46]	validation_0-logloss:0.22345
    [47]	validation_0-logloss:0.22291
    [48]	validation_0-logloss:0.22232
    [49]	validation_0-logloss:0.22214
    [50]	validation_0-logloss:0.22106
    [51]	validation_0-logloss:0.22071
    [52]	validation_0-logloss:0.21985
    [53]	validation_0-logloss:0.21957
    [54]	validation_0-logloss:0.21935
    [55]	validation_0-logloss:0.21927
    [56]	validation_0-logloss:0.21893
    [57]	validation_0-logloss:0.21906
    [58]	validation_0-logloss:0.21885
    [59]	validation_0-logloss:0.21873
    [60]	validation_0-logloss:0.21862
    [61]	validation_0-logloss:0.21835
    [62]	validation_0-logloss:0.21809
    [63]	validation_0-logloss:0.21844
    [64]	validation_0-logloss:0.21820
    [65]	validation_0-logloss:0.21807
    [66]	validation_0-logloss:0.21803
    [67]	validation_0-logloss:0.21792
    [68]	validation_0-logloss:0.21775
    [69]	validation_0-logloss:0.21711
    [70]	validation_0-logloss:0.21661
    [71]	validation_0-logloss:0.21648
    [72]	validation_0-logloss:0.21618
    [73]	validation_0-logloss:0.21586
    [74]	validation_0-logloss:0.21601
    [75]	validation_0-logloss:0.21588
    [76]	validation_0-logloss:0.21578
    [77]	validation_0-logloss:0.21569
    [78]	validation_0-logloss:0.21587
    [79]	validation_0-logloss:0.21551
    [80]	validation_0-logloss:0.21543
    [81]	validation_0-logloss:0.21546
    [82]	validation_0-logloss:0.21578
    [83]	validation_0-logloss:0.21549
    [84]	validation_0-logloss:0.21550
    [85]	validation_0-logloss:0.21532
    [86]	validation_0-logloss:0.21511
    [87]	validation_0-logloss:0.21500
    [88]	validation_0-logloss:0.21520
    [89]	validation_0-logloss:0.21491
    [90]	validation_0-logloss:0.21492
    [91]	validation_0-logloss:0.21482
    [92]	validation_0-logloss:0.21490
    [93]	validation_0-logloss:0.21478
    [94]	validation_0-logloss:0.21436
    [95]	validation_0-logloss:0.21432
    [96]	validation_0-logloss:0.21423
    [97]	validation_0-logloss:0.21420
    [98]	validation_0-logloss:0.21392
    [99]	validation_0-logloss:0.21328
    [100]	validation_0-logloss:0.21324
    [101]	validation_0-logloss:0.21324
    [102]	validation_0-logloss:0.21299
    [103]	validation_0-logloss:0.21286
    [104]	validation_0-logloss:0.21327
    [105]	validation_0-logloss:0.21334
    [106]	validation_0-logloss:0.21303
    [107]	validation_0-logloss:0.21323
    [108]	validation_0-logloss:0.21279
    [109]	validation_0-logloss:0.21309
    [110]	validation_0-logloss:0.21321
    [111]	validation_0-logloss:0.21324
    [112]	validation_0-logloss:0.21324
    [113]	validation_0-logloss:0.21318
    [114]	validation_0-logloss:0.21295
    [115]	validation_0-logloss:0.21263
    [116]	validation_0-logloss:0.21258
    [117]	validation_0-logloss:0.21222
    [118]	validation_0-logloss:0.21155
    [119]	validation_0-logloss:0.21139
    [120]	validation_0-logloss:0.21110
    [121]	validation_0-logloss:0.21093
    [122]	validation_0-logloss:0.21087
    [123]	validation_0-logloss:0.21128
    [124]	validation_0-logloss:0.21112
    [125]	validation_0-logloss:0.21137
    [126]	validation_0-logloss:0.21103
    [127]	validation_0-logloss:0.21062
    [128]	validation_0-logloss:0.21055
    [129]	validation_0-logloss:0.21064
    [130]	validation_0-logloss:0.21060
    [131]	validation_0-logloss:0.21038
    [132]	validation_0-logloss:0.21004
    [133]	validation_0-logloss:0.20982
    [134]	validation_0-logloss:0.20955
    [135]	validation_0-logloss:0.20936
    [136]	validation_0-logloss:0.20949
    [137]	validation_0-logloss:0.20986
    [138]	validation_0-logloss:0.20965
    [139]	validation_0-logloss:0.20949
    [140]	validation_0-logloss:0.20922
    [141]	validation_0-logloss:0.20908
    [142]	validation_0-logloss:0.20885
    [143]	validation_0-logloss:0.20875
    [144]	validation_0-logloss:0.20856
    [145]	validation_0-logloss:0.20884
    [146]	validation_0-logloss:0.20945
    [147]	validation_0-logloss:0.20911
    [148]	validation_0-logloss:0.20951
    [149]	validation_0-logloss:0.20928
    [150]	validation_0-logloss:0.20931
    [151]	validation_0-logloss:0.20934
    [152]	validation_0-logloss:0.20893
    [153]	validation_0-logloss:0.20893
    [154]	validation_0-logloss:0.20898
    [155]	validation_0-logloss:0.20892
    [156]	validation_0-logloss:0.20844
    [157]	validation_0-logloss:0.20864
    [158]	validation_0-logloss:0.20870
    [159]	validation_0-logloss:0.20897
    [160]	validation_0-logloss:0.20883
    [161]	validation_0-logloss:0.20862
    [162]	validation_0-logloss:0.20825
    [163]	validation_0-logloss:0.20853
    [164]	validation_0-logloss:0.20836
    [165]	validation_0-logloss:0.20802
    [166]	validation_0-logloss:0.20819
    [167]	validation_0-logloss:0.20831
    [168]	validation_0-logloss:0.20784
    [169]	validation_0-logloss:0.20794
    [170]	validation_0-logloss:0.20807
    [171]	validation_0-logloss:0.20753
    [172]	validation_0-logloss:0.20788
    [173]	validation_0-logloss:0.20813
    [174]	validation_0-logloss:0.20839
    [175]	validation_0-logloss:0.20847
    [176]	validation_0-logloss:0.20857
    [177]	validation_0-logloss:0.20824
    [178]	validation_0-logloss:0.20865
    [179]	validation_0-logloss:0.20897

